<!DOCTYPE html><html lang="zh"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' blob: data: https://unpkg.com">
    <title>iPhone 價格表</title>
    <script src="https://unpkg.com/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
        .price {
            text-align: right;
        }
        #status {
            margin: 10px 0;
            color: #666;
        }
        #uploadSection {
            margin-bottom: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        #debugText {
            display: none;
        }
        .model-header {
            background-color: #e0e0e0;
            font-weight: bold;
        }
        tr.model-section td {
            background-color: #f8f8f8;
        }
        #console {
            display: none;
        }
    </style>
</head>
<body>
    <div id="uploadSection">
        <input type="file" id="imageInput" accept="image/*">
        <div id="status">等待上傳圖片...</div>
    </div>

    <table id="priceTable">
        <thead>
            <tr>
                <th>型號</th>
                <th>容量</th>
                <th>價格 (HKD)</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        // 禁用控制台輸出
        console.log = function() {};
        console.error = function() {};
        console.warn = function() {};
        console.info = function() {};
        console.debug = function() {};

        // 定義所有型號和容量組合
        const models = {
            "iPhone 16": {
                base: ["128GB", "256GB", "512GB"],
                prices: [3750, 4500, 4950]
            },
            "iPhone 16 Plus": {
                base: ["128GB", "256GB", "512GB"],
                prices: [4400, 5050, 5500]
            },
            "iPhone 16 Pro": {
                base: ["128GB", "256GB", "512GB", "1TB"],
                prices: [5450, 5850, 6300, 6650]
            },
            "iPhone 16 Pro Max": {
                base: ["256GB", "512GB", "1TB"],
                prices: [7050, 7600, 8150]
            },
            "iPhone 15": {
                base: ["128GB", "256GB", "512GB"],
                prices: [2950, 3700, 4150]
            },
            "iPhone 15 Plus": {
                base: ["128GB", "256GB", "512GB"],
                prices: [3550, 4250, 4650]
            },
            "iPhone 15 Pro": {
                base: ["128GB", "256GB", "512GB", "1TB"],
                prices: [4300, 4900, 5250, 5700]
            },
            "iPhone 15 Pro Max": {
                base: ["256GB", "512GB", "1TB"],
                prices: [5100, 5750, 6350]
            },
            "iPhone 14": {
                base: ["128GB", "256GB", "512GB"],
                prices: [2100, 2850, 3150]
            },
            "iPhone 14 Plus": {
                base: ["128GB", "256GB", "512GB"],
                prices: [3000, 3500, 3700]
            },
            "iPhone 13": {
                base: ["128GB", "256GB", "512GB"],
                prices: [2000, 2400, 2750]
            },
            "iPhone SE 3": {
                base: ["64GB", "128GB", "256GB"],
                prices: [850, 1200, 1400]
            }
        };

        function displayPrices() {
            const tbody = document.querySelector('#priceTable tbody');
            tbody.innerHTML = '';

            for (const [model, data] of Object.entries(models)) {
                data.base.forEach((capacity, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${model}</td>
                        <td>${capacity}</td>
                        <td class="price">${data.prices[index]}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
        }

        // 初始顯示價格
        displayPrices();

        // OCR 處理相關函數
        let worker = null;

        async function initializeWorker() {
            try {
                worker = await Tesseract.createWorker({
                    logger: m => {
                        document.getElementById('status').textContent = m.status + ': ' + 
                            (m.progress ? Math.round(m.progress * 100) + '%' : '');
                    }
                });
                await worker.loadLanguage('eng');
                await worker.initialize('eng');
            } catch (error) {
                document.getElementById('status').textContent = '初始化失敗，請重新載入頁面';
            }
        }

        async function processImage(file) {
            if (!worker) {
                await initializeWorker();
            }

            try {
                const result = await worker.recognize(file);
                const text = result.data.text;
                
                const lines = text.split('\n');
                let updatedPrices = false;

                lines.forEach(line => {
                    if (line.includes('IPHONE')) {
                        const parts = line.trim().split(/\s+/);
                        if (parts.length >= 4) {
                            const modelParts = parts.slice(0, -3);
                            let model = '';
                            let capacity = '';
                            
                            modelParts.forEach(part => {
                                if (part.includes('GB')) {
                                    capacity = part;
                                } else {
                                    model = model + (model ? ' ' : '') + part;
                                }
                            });

                            const price = parseInt(parts[parts.length - 2], 10);
                            
                            if (models[model] && !isNaN(price)) {
                                const capacityIndex = models[model].base.indexOf(capacity);
                                if (capacityIndex !== -1) {
                                    models[model].prices[capacityIndex] = price;
                                    updatedPrices = true;
                                }
                            }
                        }
                    }
                });

                if (updatedPrices) {
                    displayPrices();
                    document.getElementById('status').textContent = '價格更新完成';
                } else {
                    document.getElementById('status').textContent = '未能從圖片中識別出價格信息';
                }

            } catch (error) {
                document.getElementById('status').textContent = '處理圖片時發生錯誤，請重試';
            }
        }

        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                processImage(file);
            }
        });

        initializeWorker().catch(() => {
            document.getElementById('status').textContent = '初始化失敗，請重新載入頁面';
        });
    </script>


</body></html>